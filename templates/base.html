<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ENSEA Data Science Club - Plateforme collaborative pour les passionnÃ©s de data science">
  <title>{% block title %}ENSEA Data Science Club{% endblock %}</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
  {% block head_scripts %}
    <!-- CKEditor for rich text editing -->
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Socket.IO for real-time notifications -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
  {% endblock %}
</head>
<body class="bg-light">
  <!-- Navigation -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #0055A4;" aria-label="Main navigation">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.index') }}">
          <img src="{{ url_for('static', filename='images/logo_club.png') }}" alt="ENSEA Data Science Club Logo" height="40" class="me-2">
          <span class="fw-bold">ENSEA Data Science Club</span>
        </a>
        <!-- Toggler -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Menu -->
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav ms-auto align-items-center">
            {% if current_user.is_authenticated %}
              <!-- Resources Dropdown -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="resourcesMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Ressources
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="resourcesMenu">
                  <li><a class="dropdown-item" href="{{ url_for('resources.list_resources') }}">Liste des ressources</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('resources.upload_resource') }}">Proposer une ressource</a></li>
                </ul>
              </li>
              <!-- Other Links -->
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.list_events') }}">EvÃ©nements</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('forum.index') }}">Forum</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.dashboard') }}">Dashboard</a>
              </li>
              
               <!-- Admin Menu -->
              {% if current_user.role == 'admin' %}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="adminMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-cog me-1"></i> Admin
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminMenu">
                    <li><a class="dropdown-item" href="{{ url_for('admin.dashboard') }}">Tableau de bord de Gestion</a></li>
                    <!-- Add more admin routes here as needed -->
                  </ul>
                </li>
              {% endif %}
              <!-- Notification Icon -->
              <li class="nav-item">
                <a class="nav-link position-relative" href="{{ url_for('forum.notifications') }}" id="notificationIcon">
                  <i class="fas fa-bell"></i>
                  {% if unread_count > 0 %}
                    <span class="badge bg-danger rounded-circle position-absolute top-0 start-100 translate-middle" style="font-size: 0.7em;">{{ unread_count }}</span>
                  {% endif %}
                </a>
              </li>
              <!-- User Menu -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <img src="{{ current_user.avatar_url if current_user.avatar_url else url_for('static', filename='images/default-avatar.png') }}"
                       alt="Avatar de {{ current_user.username }}" class="rounded-circle me-2" width="32" height="32" style="object-fit: cover;">
                  <span>{{ current_user.username }}{% if current_user.points %} ({{ current_user.points }} XP){% endif %}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                  <li><h6 class="dropdown-header">{{ current_user.username }}</h6></li>
                  <li><a class="dropdown-item" href="{{ url_for('user.profile', username=current_user.username) }}">Mon profil</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}">
                      <i class="fas fa-sign-out-alt me-1"></i> DÃ©connexion
                    </a>
                  </li>
                </ul>
              </li>
            {% else %}
              <!-- Guest Links -->
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('auth.login') }}">Connexion</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('auth.register') }}">Inscription</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.about') }}">A propos</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="container mt-4">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <!-- Page Content -->
    {% block content %}{% endblock %}
  </main>

  <!-- Chatbot widget -->
  <div id="chatbot-container">
    <button id="chatbot-toggle" aria-label="Ouvrir le chat">ðŸ¤–</button>
    <div id="chatbot-window" class="d-none">
      <div id="chatbot-messages"></div>
      <div id="chatbot-input-area">
        <input id="chatbot-input" placeholder="Votre messageâ€¦" autocomplete="off">
        <button id="chatbot-send" aria-label="Envoyer">âž¤</button>
      </div>
    </div>
  </div>

<!-- Chatbot window -->
<div id="chatbot-window"
     class="card position-fixed shadow-lg d-none"
     style="bottom:80px; right:20px; width:320px; max-height:400px; overflow:hidden; z-index:1050;">
  <div class="card-header bg-primary text-white">
    EDScBot
    <button type="button" class="btn-close btn-close-white float-end" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="card-body d-flex flex-column p-2" style="height:320px;">
    <div id="chatbot-messages" class="flex-grow-1 mb-2 overflow-auto"></div>
    <div class="input-group">
      <input id="chatbot-input" type="text" class="form-control" placeholder="Posez une questionâ€¦">
      <button id="chatbot-send" class="btn btn-primary">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>


  <!-- Footer -->
  <footer class="text-center py-4 mt-5 border-top" style="background-color: #F8F9FA;">
    <div class="container">
      <p class="text-muted mb-2">
        Â© 2025 ENSEA Data Science Club. Tous droits rÃ©servÃ©s.
      </p>
      <ul class="list-inline">
        <li class="list-inline-item">
          <a href="{{ url_for('main.about') }}" class="text-muted text-decoration-none">Ã€ propos</a>
        </li>
      </ul>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <!-- Custom JS -->
   <script src="{{ url_for('static', filename='js/forum.js') }}"></script>
  <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>

  {% block body_scripts %}{% endblock %}
</body>
</html>